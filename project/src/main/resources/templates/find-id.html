<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title th:text="|${pageName}|"></title>
	<link rel="stylesheet" th:href="@{/css/scroll.css}">
	<link rel="stylesheet" th:href="@{/css/nav_보현.css}">
	<link rel="stylesheet" th:href="@{/css/find-id.css}">
	<!-- Bootstrap CSS CDN -->
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Bootstrap Icons CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
	<!-- Bootstrap Date Range Picker CSS -->
	<link href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" rel="stylesheet">
</head>
<body>
<div class="header">
<!-- 네비게이션 바 -->
<div th:insert="~{nav :: nav}"></div>
<!-- 네비게이션 바의 높이만큼 여백을 주어 콘텐츠가 네비게이션 바 아래에 위치하도록 함 -->
	<div style="height: 60px;"></div> 
</div>
    <!-- 아이디 찾기 폼 -->
	<div class="findidform">
        <h1>아이디 찾기</h1>

        <!-- 이메일 입력 폼 -->
        <form id="emailForm" action="/api/v1/email/send" method="POST">
            <label for="uEmail" class="form-label">가입시 등록이메일</label>
            <input type="email" class="form-control" id="uEmail" name="mail" placeholder="이메일을 입력하세요" required>
            <button type="submit" class="btn btn-success">인증 코드 보내기</button>
        </form>

        <!-- 아이디 찾기 폼 -->
        <form action="/security-login/find-id/find-id-result" method="POST">
            <label for="verifyCode" class="form-label">인증 코드</label>
            <input type="text" class="form-control" id="verifyCode" name="verifyCode" placeholder="인증 코드를 입력하세요" required>
            <input type="hidden" id="uEmailHidden" name="mail" value="">
            <button type="submit" class="btn btn-success">아이디 찾기</button>
        </form>

        <!-- 오류 메시지 출력 -->
        <div th:if="${error}" class="alert alert-danger mt-4" role="alert">
            <p th:text="${error}"></p>
        </div>
	</div>
	<!-- 스크롤 업-->
	<div>
		<i class="bi bi-arrow-up-square-fill" id="scrollUpIcon"></i>
	</div>
	<div th:replace="~{footer :: footer}"></div>
	<!-- jQuery (필수) -->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<!-- Bootstrap JS and dependencies -->
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<!-- Moment.js (필수) -->
	<script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
	<!-- Bootstrap Date Range Picker JS -->
	<script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
	<!-- 스크립트 -->
	<script th:src="@{/js/page_nav.js}" type="text/javascript"></script>
	<script th:src="@{/js/scroll.js}" type="text/javascript"></script>
	
	<script>
	    $(document).ready(function() {
	        $('#emailForm').on('submit', function(event) {
	            event.preventDefault();
	            
	            var email = $('#uEmail').val();
	            
	            // 이메일 발송 요청
	            $.ajax({
	                type: 'POST',
					url: '/security-login/send-email', // AJAX 요청 URL을 컨트롤러에 맞게 수정
	                data: JSON.stringify({ mail: email }),
	                contentType: 'application/json; charset=utf-8',
					success: function(response) {
					    alert('이메일로 인증 코드를 보냈습니다.');
					    $('#uEmailHidden').val(email);
					    console.log("Hidden input value: " + $('#uEmailHidden').val()); // Hidden input 확인
					},
	                error: function() {
	                    alert('인증 코드 발송에 실패했습니다.');
	                }
	            });
	        });
	    });
	</script>
</body>
</html>
