<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title th:text="|${pageName}|"></title>
    <link rel="stylesheet" th:href="@{/css/mypage_styles.css}">
    <link rel="stylesheet" th:href="@{/css/nav_보현.css}">
    <link rel="stylesheet" th:href="@{/css/scroll.css}">
    <link rel="stylesheet" th:href="@{/css/info_review_styles.css}">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" rel="stylesheet">
</head>

<body>
    <div class="header">
        <!-- 네비게이션 바 -->
       <div th:insert="~{nav :: nav}"></div>
        <div style="height: 60px;"></div>
    </div>

    <!-- body -->
    <div class="container">
        <div class="container-sub">
            <h1><a th:href="@{/security-login/info}">My Page</a></h1>
        </div>

		<div class="layout">
				<!-- Sidebar Section -->
				<div class="sidebar">
					<div class="profile-container">
						<div class="profile-img"><img src="/images/profile.jpg"></div>
						<div class="profile-info">
							<div class="semiinfo" th:text="${user.uRole}"></div>
							<div class="semiinfo"><span
									th:text="${#lists.isEmpty(dogInfos) ? '애견 정보 없음' : (dogInfos[0].dogName + ' 주인님,')}"></span>
							</div>
							<div class="semiinfo" th:text="${user.uName} + '님'"></div>
						</div>
					</div>

                <div class="info-main-category">
                    <div class="infomodify-category"><a th:href="@{/{loginType}/info/modify(loginType=${loginType})}">개인정보수정</a></div>
                    <div class="infomodify-category"><a th:href="@{/{loginType}/info/my-reservations(loginType=${loginType})}">나의 예약관리</a></div>
                    <div class="infomodify-category"><a th:href="@{/wishlist/my-favorites}">나의 찜목록</a></div>
                    <div class="infomodify-category"><a th:href="@{/{loginType}/info/my-point(loginType=${loginType})}">나의 포인트관리</a></div>
                    <div class="infomodify-category"><a th:href="@{/userReviewList}">내가 쓴 리뷰확인</a></div>
                </div>
            </div>
            <!-- Main Content Section -->
            <div class="main-content">
                <div class="main-content-div">
                    <table id="reviewTable">
                        <colgroup>
                            <col style="width: 10%;">
                            <col style="width: 10%;">
                            <col style="width: 55%;">
                            <col style="width: 10%;">
                            <col style="width: 10%;">
                        </colgroup>
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>별점</th>
                                <th>내용</th>
                                <th>작성자</th>
                                <th>작성일</th>
                            </tr>
                        </thead>
                        <tbody id="userReviewDataList" th:each="status: ${reviews}">
                            <tr th:id="${status.review.review_id}">
                                <input type="hidden" th:id="${status.review.review_id}+_review_star" 
                                       th:name="${status.review.review_id}+_review_star" 
                                       th:value="${status.review.review_star}">
                                <input type="hidden" th:id="${status.review.review_id}+_review_content" 
                                       th:name="${status.review.review_id}+_review_content" 
                                       th:value="${status.review.content}">
                                <th:block th:each="file : ${reviewFiles}">
                                    <th:block th:if="${file.review.review_id == status.review.review_id}">
                                        <div th:id="${status.review.review_id}+_review_file" class="hide"> 
                                            <a th:download="${file.review_filename}" 
                                               th:href="'data:image/jpeg;base64,'+${file.review_file}">
                                                <img th:src="'data:image/jpeg;base64,'+${file.review_file}" 
                                                     width="150px" height="150px" style="border-radius: 15px;">
                                            </a>
                                        </div>
                                    </th:block>
                                </th:block>
                                <td th:text="${status.rn}"></td>
                                <td class="stars" th:text="${status.review_star_txt}"></td>
                                <td>
                                    <div class="txt_line" th:text="${status.review.content}"></div>
                                </td>
                                <td th:text="${status.review.user_id}"></td>
                                <td th:text="${status.review.created_at}"></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="pagination" id="pagination"></div>

                    <div class="modal fade" id="reviewModalCenter" tabindex="-1" role="dialog" 
                         aria-labelledby="reviewModalCenterTitle" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="reviewModalCenterTitle">리뷰 수정</h5>
                                    <button type="button" id="reviewModalCloseTop" class="close" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="reviews">
                                        <input type="hidden" id="review_id" name="review_id">
                                        <div>
                                            <label>별점:</label>
                                            <div class="star-rating">
                                                <input type="radio" id="star5" name="review_star" value="5" disabled>
                                                <label for="star5">&#9733;</label>
                                                <input type="radio" id="star4" name="review_star" value="4" disabled>
                                                <label for="star4">&#9733;</label>
                                                <input type="radio" id="star3" name="review_star" value="3" disabled>
                                                <label for="star3">&#9733;</label>
                                                <input type="radio" id="star2" name="review_star" value="2" disabled>
                                                <label for="star2">&#9733;</label>
                                                <input type="radio" id="star1" name="review_star" value="1" disabled>
                                                <label for="star1">&#9733;</label>
                                            </div>
                                        </div>
                                        <div>
                                            <label>내용:</label>
                                            <textarea id="content" name="content" disabled></textarea>
                                        </div>
                                        <div id="review_file">
                                            <!-- 이미지 파일 (미리보기 등) -->
                                        </div>
                                        <div style="text-align: left;">
                                            <label for="image">이미지 변경:</label>
                                            <input type="file" id="image" name="image" disabled>
                                        </div>
                                        <input type="hidden" id="imgChg" name="imgChg" value="0">
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" id="editButton" class="btn btn-primary">수정하기</button>
                                    <button type="button" id="saveButton" class="btn btn-success hide">수정완료</button>
                                    <button type="button" id="deleteButton" class="btn btn-danger hide">삭제</button>
                                    <button type="button" id="closeButton" class="btn btn-secondary">닫기</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 스크롤 업 -->
            <div>
                <i class="bi bi-arrow-up-square-fill" id="scrollUpIcon"></i>
            </div>
        </div>
    </div>

    <div th:replace="footer :: footer"></div>

    <!-- jQuery (필수) -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- Moment.js (필수) -->
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
    <!-- Bootstrap Date Range Picker JS -->
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <!-- 스크립트 -->
    <script th:src="@{/js/page_nav.js}" type="text/javascript"></script>
    <script th:src="@{/js/scroll.js}" type="text/javascript"></script>
    <script src="/js/user_review_list.js"></script>
</body>

</html>
